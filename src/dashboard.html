<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Zoom3D Dashboard</title>
<style>
body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
#graph { width: 70%; height: 100%; float: left; }
#overlay { width: 30%; height: 100%; float: right; background: #f0f0f0; overflow-y: auto; padding: 20px; box-sizing: border-box; display: none; }
</style>
<script src="https://cdn.jsdelivr.net/npm/force-graph"></script>
</head>
<body>
<div id="graph"></div>
<div id="overlay">
  <h2>Class Notes & Flashcards</h2>
  <p>Notes and flashcards organized by weeks/lessons will appear here.</p>
  <p>OpenAI API Token: <span id="apiToken">[YOUR_OPENAI_API_TOKEN]</span></p>
  <button id="closeOverlay">Close</button>
</div>
<script>
let fullData;
let currentFocus;
function fetchData(){
 fetch('treeData.json').then(res=>res.json()).then(data=>{
  fullData = data;
  currentFocus = fullData.nodes.find(n=>n.id==="Goal");
  renderGraph();
 });
}
function getChildren(node){
 return fullData.nodes.filter(n=>n.parent===node.id);
}
function getParent(node){
 return fullData.nodes.find(n=>n.id===node.parent);
}
function isLeaf(node){
 return getChildren(node).length===0;
}
function graphData(){
 let nodes = [], links = [];
 if(currentFocus.parent){
  let parent = getParent(currentFocus);
  let siblings = fullData.nodes.filter(n=>n.parent===parent.id);
  nodes.push(parent);
  siblings.forEach(n=>nodes.push(n));
  fullData.links.forEach(l=>{
   if(l.source===parent.id && siblings.find(s=>s.id===l.target)){
    links.push(l);
   }
  });
 } else {
  nodes.push(currentFocus);
  let children = getChildren(currentFocus);
  children.forEach(n=>nodes.push(n));
  fullData.links.forEach(l=>{
   if(l.source===currentFocus.id && children.find(c=>c.id===l.target)){
    links.push(l);
   }
  });
 }
 return { nodes: nodes, links: links };
}
let Graph = ForceGraph()(document.getElementById('graph'))
  .nodeLabel('id')
  .onNodeClick(node=>{
   if(currentFocus.parent && node.id===getParent(currentFocus).id){
    currentFocus = getParent(currentFocus);
    document.getElementById('overlay').style.display = 'none';
    renderGraph();
   } else if(node.id!==currentFocus.id){
    currentFocus = node;
    if(isLeaf(currentFocus)){
     document.getElementById('overlay').style.display = 'block';
    } else {
     document.getElementById('overlay').style.display = 'none';
    }
    renderGraph();
   }
  });
function renderGraph(){
 Graph.graphData(graphData());
}
document.getElementById('closeOverlay').addEventListener('click',function(){
 document.getElementById('overlay').style.display = 'none';
});
fetchData();
</script>
</body>
</html>
